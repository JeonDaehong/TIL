---
title: Java - Error in Floating Point
author: Daehong
date: 2023-11-29
category: Jekyll
layout: post
mermaid: true
---

* 0.1 + 0.2 == 0.3 이 아니다??
* 우리가 프로그래밍을 할 때 소수점을 표현하는 방식은 크게 두 가지가 있다.
* 하나는 고정 소수점 방식이고, 하나는 부동 소수점 방식이다.

<hr>

### 1. 고정 소수점 방식
* 프로그램은 1과 0으로 모든 것을 표현한다. 정수에서는 byte 라는 8비트짜리 자료형에서 3을 표현할 때 0 0 0 0 0 0 1 1 이렇게 표현하듯 소수점도 마찬가지이다. 고정 소수점 방식은 32비트에서 미리 비트수를 정하고, 그 비트만을 활용하여 실수를 표현하는 방식이다.
	* 처음 1비트는 양수, 음수를 구별하며 ( 0일 때 양수, 1일 때 음수 )
	* 다음 15비트는 정수부
	* 다음 16비트는 소수부이다.
* 2진수로 변환된 수를 그대로 넣으면 되고, 남은 수는 0으로 채운다.
	* 예를들어 7.625를 32비트 고정소수점 방식으로 표현하면, 2^2 + 2^1 + 2^0 + 1/2^1 + 1/2^3 이기 때문에 111.101이 되고,
	* 0 / 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 / 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 이렇게 자리를 차지한다.
* 고정 소수점 방식은 Ada 와 같은 언어에서 사용되며, 소수에 사용할 비트가 16비트로 고정되어있기 때문에 큰 실수를 표현하기 어렵다.


<br>
<br>

### 2. 부동 소수점 방식
* 고정 소수점 방식의 단점을 보완하기 위해 등장한게, 부동 소수점 방식이다.
* 부동 소수점은 2진수를 정규화 하여 사용한다
* float (32비트) 기준
	* 처음 1비트는 양수, 음수를 구별하고
	* 다음 8비트는 지수부
	* 다음 23비트는 가수부로 활용한다.
* double (64비트) 기준으로
	* 처음 1비트는 양수, 음수를 구별하고
	* 다음 11비트는 지수부
	* 나머지 52비트는 가수부로 활용한다.

<br>

**부동 소수점 추가 설명**
* float를 기준으로 보면, 여기서 정규화라는 것은 2진수를 1.xxx ... * 2^n 형태로 나타내는 것을 말한다.
* 예를 들어 7.625를 부동 소수점 방식으로 나타내보자.
	* 정규화 이전에는 111.101이 나온다.
	* 정규화를 하면, 1.11101 * 2^2 가 된다.
		* 111.101이 1.11101이 되기 위해 소수점을 2번 앞으로 당겼기 때문에, 그만큼의 지수가 생긴것이다.
	* 해당 지수에서 IEEE 754 표준에 의거하여 127이라는 bias를 더한 값으로 2진수를 채워 지수부인 8비트를 완성해야 한다.
	* 따라서 2 + 127은 129가 되므로, 1 0 0 0 0 0 0 1 이 지수부 8비트에 들어가는 것이다.
		* 참고로 11비트를 지수부로 가진 double에서는 1023을 더한다.
	* 이렇게 bias를 더하는 이유는 지수가 음수일 경우를 대비하기 위해서이다.
		* 0.000101 이라는 수를 정규화 하면 1.01 * 2^-4 가 된다. 그러면 -4를 지수부에 표현할 방법이 없으므로, +127을 통해 123을 만들어서 0 1 1 1 1 0 1 1 로 만든다. 그래서 지수 + bias를 더했을 때 0 ~ 127이 나오면 음수, 128 ~ 255가 나오면 양수라고 보면 된다. ( 실제 값은 -127 ~ 0 / 1 ~ 128 )
	* 그리고 뒤에 나머지 가수부 비트에 소수를 이진수 화 한 값을 넣어주면 된다.
	* 7.625는 결국 0 / 1 0 0 0 0 0 0 1 / 1 1 1 1 0 1 0 0 0 0 ......... (32비트까지) 이렇게 표현할 수 있는 것이다.


<br>
<br>
<br>
<br>
<br>